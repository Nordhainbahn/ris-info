<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Abfahrten - RIS Info</title>
<link rel="stylesheet" href="style.css">
</head>
<body>
<div class="page-container">
    <h1>Abfahrten - NordhainBahn</h1>
    <table>
        <thead>
            <tr>
                <th>Linie</th>
                <th>Ziel</th>
                <th>Abfahrt</th>
                <th>Gleis</th>
                <th>Status</th>
                <th>Verspätung</th>
                <th>Info</th>
            </tr>
        </thead>
        <tbody id="abfahrten-table"></tbody>
    </table>
    <button class="logout-btn" onclick="logout()">Logout</button>
</div>

<script>
document.addEventListener("DOMContentLoaded", function(){
    const user = JSON.parse(localStorage.getItem("currentUser") || "{}");
    if(!user){ window.location.href="login.html"; return; }

    const today = new Date().toISOString().split("T")[0];
    let allData = JSON.parse(localStorage.getItem("abfahrtenData") || "{}");
    if(!allData[today]){
        allData[today] = [
            {linie:"101", ziel:"Nordstadt", abfahrt:"08:15", gleis:"1", ausgefallen:false, verspätung:0, grund:"", info:""},
            {linie:"102", ziel:"Südhafen", abfahrt:"08:30", gleis:"2", ausgefallen:false, verspätung:0, grund:"", info:""}
        ];
        localStorage.setItem("abfahrtenData", JSON.stringify(allData));
    }

    const tableBody = document.getElementById("abfahrten-table");

    allData[today].forEach(a => {
        const row = document.createElement("tr");
        row.innerHTML = `
            <td>${a.linie}</td>
            <td>${a.ziel}</td>
            <td>${a.abfahrt}</td>
            <td>${a.gleis}</td>
            <td>${a.ausgefallen ? "Ausgefallen" : "Planmäßig"}</td>
            <td class="verspätung-cell">${a.verspätung > 0 ? a.verspätung : 0}</td>
            <td>${a.info || "-"}</td>
        `;
        tableBody.appendChild(row);

        const verspCell = row.querySelector(".verspätung-cell");
        verspCell.style.color = a.verspätung === 0 ? "green" : "red";
    });
});

function logout(){
    localStorage.removeItem("currentUser");
    window.location.href="login.html";
}
</script>
</body>
</html>
